<!-- search-result.component.html - Updated with animations -->
<div class="custom-search-result" [class.expanded]="search.isExpanded">
  <!-- Custom Accordion Header with animations -->
  <div class="result-header" 
       [@headerHover]="headerHoverState()"
       (click)="toggleAccordion()" 
       (mouseenter)="onHeaderMouseEnter()"
       (mouseleave)="onHeaderMouseLeave()"
       [class.active]="search.isExpanded"
       role="button" 
       tabindex="0"
       (keydown.enter)="toggleAccordion()"
       (keydown.space)="toggleAccordion()">
    
    <div class="header-content">
      <div class="header-left">
        <!-- Animated Expand/Collapse Icon -->
        <i class="toggle-icon pi pi-chevron-right" 
           [@iconRotate]="search.isExpanded ? 'expanded' : 'collapsed'"></i>
        
        <span class="font-bold text-lg mr-3">{{ search.title }}</span>
        
        @if (hasTransactionDetails()) {
          <p-tag value="Transaction Details" severity="info" size="small" class="mr-2"></p-tag>
        }
        
        <span class="text-sm text-color-secondary ml-2">{{ recordsSummary() }}</span>
      </div>
      
      <!-- Buttons Container - Isolated from header click -->
      <div class="header-right" (click)="$event.stopPropagation()">
        @if(search.isStreaming) {
          <button pButton type="button" 
                  class="p-button-sm streaming-control-btn" 
                  [ngClass]="{
                    'p-button-success': !isStopButtonHovered(),
                    'p-button-danger': isStopButtonHovered()
                  }" 
                  (mouseenter)="isStopButtonHovered.set(true)" 
                  (mouseleave)="isStopButtonHovered.set(false)"
                  (click)="stopStreaming($event)" 
                  pTooltip="Stop the live data stream" 
                  tooltipPosition="top">
            
            @if (isStopButtonHovered()) {
              <span class="flex align-items-center gap-2">
                <i class="pi pi-stop-circle"></i>
                <span>Stop</span>
              </span>
            } @else {
              <span class="flex align-items-center gap-2">
                <i class="pi pi-spin pi-spinner"></i>
                <span>Streaming...</span>
              </span>
            }
          </button>
        }

        <button pButton type="button" 
                icon="pi pi-times"
                class="p-button-text p-button-rounded p-button-danger p-button-sm" 
                pTooltip="Close this result panel"
                (click)="closePanel($event)">
        </button>
      </div>
    </div>
  </div>

  <!-- Custom Accordion Content with slide animation -->
  <div class="result-content" 
       [@slideToggle]="search.isExpanded ? 'expanded' : 'collapsed'">
    
    <div class="content-wrapper" *ngIf="search.isExpanded" [@fadeInContent]>
      @if (!search.error) {
        
        <!-- Streaming Toolbar for SSE searches -->
        @if (shouldShowStreamingToolbar()) {
          <app-streaming-toolbar 
            [allAvailableColumns]="allColumnsForViewType()"
            [currentlyVisibleColumns]="streamingVisibleColumns()"
            (visibleColumnsChange)="onStreamingColumnsChange($event)" 
            (resetColumns)="resetStreamingColumns()"
            [availableFilterValues]="search.aggregatedFilterValues" 
            [appliedFilters]="search.streamFilters ?? []"
            (filtersChange)="onStreamFiltersChange($event)">
          </app-streaming-toolbar>
        }

        <!-- Transaction Toolbar for transaction searches -->
        @if (shouldShowTransactionToolbar()) {
          <app-transaction-toolbar 
            [views]="getViewsForTransaction()" 
            [selectedView]="selectedViewId()"
            (viewChange)="onViewChange($event)">
          </app-transaction-toolbar>
        }

        <!-- JIRA Toolbar for JIRA searches -->
        @if (shouldShowJiraToolbar()) {
          <app-jira-toolbar>
          </app-jira-toolbar>
        }

        <!-- Batch Toolbar for batch searches -->
        @if (shouldShowBatchToolbar()) {
          <app-batch-toolbar>
          </app-batch-toolbar>
        }

        <!-- Content Viewers -->
        @if (shouldShowLogViewer()) {
          <app-log-viewer 
            [search]="search" 
            [visibleColumns]="streamingVisibleColumns()"
            [selectedViewId]="selectedViewId()"
            (drilldown)="onDrilldown($event)">
          </app-log-viewer>
        }

        @if (shouldShowBatchViewer()) {
          <app-batch-viewer 
            [search]="search">
          </app-batch-viewer>
        }

        @if (shouldShowJiraViewer()) {
          <app-jira-viewer 
            [search]="search">
          </app-jira-viewer>
        }

      } @else {
        <!-- Error State -->
        <div class="error-container p-4">
          <div class="text-center">
            <i class="pi pi-exclamation-triangle text-4xl text-red-500 mb-3"></i>
            <h3 class="text-lg font-semibold mb-2">Search Error</h3>
            <p class="text-color-secondary mb-4">{{ search.error }}</p>
            <button pButton type="button" 
                    label="Retry Search" 
                    icon="pi pi-refresh" 
                    class="p-button-outlined"
                    (click)="retrySearch()">
            </button>
          </div>
        </div>
      }
    </div>
  </div>
</div>
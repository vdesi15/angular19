<div class="streaming-filter-container">
  <!-- ... Applied filter chips ... -->
  @for(filter of appliedFilters; track filter.field) {
    <p-chip 
      [label]="filter.displayName + ' = (' + filter.values.join(' OR ') + ')'" 
      [removable]="true" 
      (onRemove)="removeFilter(filter)"
      (click)="editFilter(filter, addFilterPopover, $event)"
      class="p-clickable"
      pTooltip="Edit this filter">
    </p-chip>
  }
  <button pButton type="button" label="Add Filter" icon="pi pi-filter-plus" class="p-button-outlined p-button-sm" (click)="resetPopover(); addFilterPopover.toggle($event)"></button>
</div>

<!-- Popover for adding/editing a filter -->
<p-popover #addFilterPopover (onShow)="onPopoverShow()">
  <div class="filter-popover-content">
    <h3>Add/Edit Filter</h3>
    <div class="filter-controls">
      <p-floatLabel>
        <p-dropdown [options]="filterableFields()" [(ngModel)]="selectedField" ...></p-dropdown>
        <label>Select Field</label>
      </p-floatLabel>
      <p-floatLabel>
        <p-multiSelect [options]="valueOptions()" [ngModel]="selectedValues()" (ngModelChange)="onValueChange($event)" ...></p-multiSelect>
        <label>Select One or More Values</label>
      </p-floatLabel>
    </div>
    <div class="popover-footer">
      <button pButton label="Apply" icon="pi pi-check" (click)="applyFilter(); addFilterPopover.hide()" ...></button>
    </div>
  </div>
</p-popover>

<!-- ✨ DIALOG FOR CUSTOM VALUE INPUT ✨ -->
<p-dialog 
  header="Enter a custom value (case-sensitive)" 
  [(visible)]="isCustomValueDialogVisible" 
  [modal]="true" 
  [style]="{ width: '25rem' }">
    
    <div class="flex align-items-center gap-3 mb-3">
        <label for="custom-value" class="font-semibold w-6rem">Value</label>
        <input pInputText id="custom-value" class="flex-auto" autocomplete="off" [(ngModel)]="customValueInput" (keydown.enter)="applyCustomValue()" autofocus />
    </div>

    <ng-template pTemplate="footer">
        <p-button label="Cancel" severity="secondary" (click)="isCustomValueDialogVisible.set(false)"></p-button>
        <p-button label="Apply" (click)="applyCustomValue()" [disabled]="!customValueInput()"></p-button>
    </ng-template>
</p-dialog>
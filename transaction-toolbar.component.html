<p-toolbar styleClass="transaction-toolbar">
    <div class="p-toolbar-group-left">
        <!-- View Selector -->
        <div class="view-selector">
            <label class="view-label">View:</label>
            <p-select [options]="views" [ngModel]="selectedView" (ngModelChange)="viewModeChanged.emit($event)"
                optionLabel="displayName" optionValue="viewid" placeholder="Select View" styleClass="view-select">
            </p-select>
        </div>
    </div>

    <div class="p-toolbar-group-right">
        <!-- Metrics Button -->
        <p-button icon="pi pi-chart-pie" label="Metrics" severity="secondary" [outlined]="true"
            (click)="metricsPanel.toggle($event)" [disabled]="!hasMetrics()" pTooltip="View transaction metrics" />

        <!-- Download Button -->
        <p-button icon="pi pi-download" label="Download" severity="secondary" [outlined]="true"
            (click)="downloadTransactionData()" pTooltip="Download transaction messages" />

        <!-- Share Menu Button -->
        <p-button icon="pi pi-share-alt" label="Share" severity="secondary" [outlined]="true"
            (click)="shareMenu.toggle($event)" pTooltip="Share transaction" />

        <!-- JIRA Menu Button -->
        <p-button icon="pi pi-ticket" label="JIRA" severity="secondary" [outlined]="true"
            (click)="jiraMenu.toggle($event)" pTooltip="JIRA actions" />
    </div>
</p-toolbar>

<!-- Metrics Overlay Panel -->
<p-overlayPanel #metricsPanel styleClass="metrics-panel">
    <div class="metrics-content">
        <h4>Transaction Metrics</h4>
        @if (metricsData(); as metrics) {
        <p-chart type="doughnut" [data]="metrics.chartData" [options]="metrics.chartOptions"
            [style]="{ width: '300px', height: '300px' }">
        </p-chart>
        } @else {
        <p class="no-metrics">No metrics data available</p>
        }
    </div>
</p-overlayPanel>

<!-- Share Menu -->
<p-menu #shareMenu [model]="shareMenuItems" [popup]="true"></p-menu>

<!-- JIRA Menu -->
<p-menu #jiraMenu [model]="jiraMenuItems" [popup]="true"></p-menu>

<!-- JIRA Upload Dialog -->
<p-dialog header="Attach Transaction to JIRA" [visible]="showJiraDialog()" [modal]="true" [style]="{ width: '450px' }"
    (onHide)="hideJiraDialog()">

    <div class="jira-dialog-content">
        <p class="dialog-description">
            Provide JIRA ticket ID to attach transaction data
        </p>

        <div class="field">
            <label for="jiraId">JIRA ID</label>
            <input id="jiraId" type="text" pInputText [(ngModel)]="jiraTicketId" placeholder="e.g., PROJ-1234"
                class="w-full" />
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button label="Upload" icon="pi pi-upload" [loading]="isUploading()" [disabled]="!jiraTicketId?.trim()"
            (click)="uploadToJira()" />

        <p-button label="Close" severity="secondary" [text]="true" (click)="hideJiraDialog()" />
    </ng-template>
</p-dialog>
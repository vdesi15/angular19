<div #tableContainer class="table-container">
  <p-table #logTable [value]="tableData" [columns]="visibleColumns" [totalRecords]="totalRecords" dataKey="_id"
    [paginator]="true" [rows]="dynamicRows()" [scrollable]="true" scrollHeight="flex" [resizableColumns]="true"
    columnResizeMode="fit" styleClass="p-datatable-striped p-datatable-sm elegant-table">

    <!-- ðŸ”¥ DEBUG: Add this temporarily to see what col.width values you have -->
    <!-- Remove this after debugging -->
    <div style="display: none;">
      DEBUG COLUMN WIDTHS:
      @for(col of visibleColumns; track col.id) {
        <span>{{ col.displayName }}: {{ col.width }} | </span>
      }
    </div>

    <!-- ðŸ”¥ BULLETPROOF: Force colgroup with explicit widths -->
    <ng-template pTemplate="colgroup" let-columns>
      <colgroup>
        @for(col of columns; track col.id) {
          <!-- ðŸ”¥ DEBUG: Log the width being applied -->
          <!-- {{ logColumnWidth(col) }} -->
          <col [style.width]="col.width" [style.min-width]="col.width" [style.max-width]="col.width">
        }
      </colgroup>
    </ng-template>

    <ng-template pTemplate="header" let-columns>
      <!-- ðŸ”¥ FORCE: Apply width directly to th elements as backup -->
      <tr class="header-row">
        @for(col of columns; track col.id) {
          <th pResizableColumn 
              [style.width]="col.width" 
              [style.min-width]="col.width" 
              [style.max-width]="col.width">
            {{ col.displayName }}
          </th>
        }
      </tr>

      <tr class="filter-row">
        @for(col of columns; track col.id) {
          <th [style.width]="col.width" 
              [style.min-width]="col.width" 
              [style.max-width]="col.width">
            @if(col.enableFiltering) {
              <input 
                type="text" 
                pInputText 
                class="custom-column-filter"
                [placeholder]="'Filter ' + col.displayName"
                (input)="applyColumnFilter($event, col.id+'_filter', 'contains')"
                (click)="$event.stopPropagation()">
            }
          </th>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-columns="columns">
      <tr class="elegant-row">
        @for(col of columns; track col.id){
          <!-- ðŸ”¥ FORCE: Apply width to td elements too -->
          <td tooltipPosition="top" 
              class="elegant-cell"
              [style.width]="col.width" 
              [style.min-width]="col.width" 
              [style.max-width]="col.width"
              [class.clickable-cell]="isCellClickable(col, rowData)"
              (click)="handleCellClick(col, rowData, $event, getCellValue(rowData, col.field))">
            <div class="cell-content" [innerHTML]="getCellDisplayValue(rowData, col)"></div>
          </td>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length" class="empty-state">
          <div class="empty-content">
            <i class="pi pi-info-circle"></i>
            <p>No records found</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<div #tableContainer class="table-container">
  <p-table #logTable 
    [value]="tableData" 
    [columns]="visibleColumns" 
    [totalRecords]="totalRecords" 
    dataKey="_id"
    [paginator]="true" 
    [rows]="20"
    [rowsPerPageOptions]="[10, 20, 50, 100]" 
    [scrollable]="true" 
    scrollHeight="flex"
    [resizableColumns]="true" 
    columnResizeMode="fit"
    styleClass="p-datatable-striped p-datatable-sm elegant-table">

    <!-- ðŸ”¥ FIX #1: Define column widths explicitly in a colgroup -->
    <ng-template pTemplate="colgroup" let-columns>
      <colgroup>
        @for(col of columns; track col.id) {
          <col [style.width]="col.width">
        }
      </colgroup>
    </ng-template>

    <ng-template pTemplate="header" let-columns>
      <!-- Column Display Names (No width style needed here anymore) -->
      <tr class="header-row">
        @for(col of columns; track col.id) {
          <th pResizableColumn>{{ col.displayName }}</th>
        }
      </tr>
      
      <!-- Per-Column Filter Inputs -->
      <tr class="filter-row">
        @for(col of columns; track col.id) {
          <th>
            @if(col.enableFiltering) {
              <!-- ... your filter template is fine ... -->
            }
          </th>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-rowData let-columns="columns">
      <tr class="elegant-row">
        @for(col of columns; track col.id){
          <td 
            [pTooltip]="getCellDisplayValue(rowData, col)"
            tooltipPosition="top"
            class="elegant-cell"
            [class.clickable-cell]="isCellClickable(col, rowData)" 
            (click)="handleCellClick(col, rowData, $event, getCellValue(rowData, col.field))">
            <!-- Use a div wrapper to handle text overflow gracefully -->
            <div class="cell-content" [innerHTML]="getCellDisplayValue(rowData, col)"></div>
          </td>
        }
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns.length" class="empty-state">
          <div class="empty-content">
            <i class="pi pi-info-circle"></i>
            <p>No records found</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
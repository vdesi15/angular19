<p-accordion [multiple]="true" [activeIndex]="search.isExpanded ? 0 : -1" styleClass="result-accordion">
    <p-accordionTab [toggleable]="true" [collapsible]="true">
      <ng-template pTemplate="header">
        <div class="flex align-items-center justify-content-between w-full p-2">
          <span class="font-bold text-lg">{{ search.title }}</span>
          @if(search.isStreaming) {
            <div class="flex align-items-center gap-3">
              <span class="text-sm text-color-secondary">{{ search.data.length }} records loaded...</span>
              <button pButton type="button" icon="pi pi-stop-circle" label="Stop" class="p-button-sm p-button-danger" (click)="orchestrator.stopSseStream(search.id); $event.stopPropagation()"></button>
            </div>
          }
        </div>
      </ng-template>
  
      <app-results-toolbar [views]="availableViews()" [(ngModel)]="selectedViewId"></app-results-toolbar>
      
      <div class="result-content-wrapper">
        @if (search.isLoading && search.data.length === 0) {
          <app-table-skeleton [columns]="columns()"></app-table-skeleton>
        } @else if (search.error) {
          <p class="p-3 text-red-500">{{ search.error }}</p>
        } @else {
          <app-log-viewer 
            [searchInstance]="search"
            [allColumnsForViewType]="columns()" 
            [viewId]="selectedViewId()"
            (rowDrilldown)="onDrilldown($event)">
          </app-log-viewer>
        }
      </div>
    </p-accordionTab>
  </p-accordion>